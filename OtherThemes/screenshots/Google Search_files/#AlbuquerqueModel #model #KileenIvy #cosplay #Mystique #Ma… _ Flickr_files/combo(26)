YUI.add("flickr-photosets-addPhoto-creator",function(e,o){"use strict";e.namespace("ModelCreators")["flickr-photosets-addPhoto"]={run:function(t,s){var l={full_response:1},u=[],d=t.isMultiplePhotos?"photo_ids":"photo_id",r=t.photoID.split(",").length;return l[d]=t.photoID,l.photoset_id=t.setID,t.gpCode&&(l.gp_code=t.gpCode),t.gpOwner&&(l.gp_owner=t.gpOwner),t.shareCode&&(l.share_code=t.shareCode),t.includeHiddenSets&&(l.extras="hidden_sets",l.user_id=t.userId),u=[s.callAPI("flickr.photosets.addPhoto",l),s.getModel("set-models",t.setID),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-contexts-models")],t.isMultiplePhotos||u.push(s.getModel("photo-models",t.photoID)),e.Promise.all(u).then(function(e){var o,s=e[0],l=e[1],u=e[2],d=e[3],h=s.errors,i=s.errors?s.errors.length:0;if(r-=i,"ok"===s.stat)return t.isMultiplePhotos?l&&t.updateItemCounts&&(l.setValue("photoCount",l.getValue("photoCount")+t.numberOfPhotosSelected),l.setValue("videoCount",l.getValue("videoCount")+t.numberOfVideosSelected)):(o=e[4],l&&!l.hasPhoto(o.getValue("id"))&&(l.addPhoto(o),o.getValue("isVideo")?l.setValue("videoCount",l.getValue("videoCount")+1):l.setValue("photoCount",l.getValue("photoCount")+1))),u.exists(t.photoID)&&!u.getValue(t.photoID,"sets").getFromListByID(l.getValue("id"))&&(u.getValue(t.photoID,"sets").prependToList(l),u.setValue(t.photoID,"total",u.getValue(t.photoID,"total")+r)),d.exists(t.photoID)&&!d.getValue(t.photoID,"contexts").getFromListByID(l.getValue("id"))&&(d.setValue(t.photoID,"totalSets",d.getValue(t.photoID,"totalSets")+r),d.getValue(t.photoID,"contexts").push(l)),t.isMultiplePhotos?(i&&h.forEach(function(e){-1!==t.photosSelectedIds.indexOf(e.photo_id)?l.setValue("photoCount",l.getValue("photoCount")-1):l.setValue("videoCount",l.getValue("videoCount")-1)}),{errors:h,setModel:l}):l},function(t){return e.FetcherErrorLogger(o),t}.bind(this))}}},"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","photo-sets-models","photo-contexts-models"]});YUI.add("flickr-photosets-getList-fetcher",function(e,t){"use strict";e.namespace("ListFetchers")["flickr-photosets-getList"]={run:function(s,o){var a=this,r=this._processParams(s);return e.Promise.all([o.callAPI("flickr.photosets.getList",r,!0),o.getModelRegistry("sets-models"),o.getModelRegistry("set-models"),o.getModel("person-models",s.id||{pathAlias:s.pathAlias})]).then(function(e){return a._processResponse(e,s)},e.FetcherErrorLogger(t))},_processParams:function(t){var s={primary_photo_extras:e.APIHelper.request.getRebootAlbumsListExtras(),page:t.page,per_page:t.perPage||500,get_user_info:1,extras:"can_share,can_download"};if(t.id)s.user_id=t.id;else{if(!t.pathAlias)throw new Error("[flickr-favorites-getList-fetcher] `id` or `pathAlias` is required.");s.path_alias=t.pathAlias}return s},_processResponse:function(t,s){var o,a,r=t[0],i=t[1],p=t[2],n=t[3],l=r.photosets,h={},d=n.getValue("id"),c=[];if(l)return l.photoset&&e.Array.each(l.photoset,function(t,s){if(0!==t.visibilityCanSeeSet){var o={id:t.id,title:t.title.content,description:t.description.content,owner:n,primary:t.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(t),isAutoUploadSet:t.autoUpload,primaryNeedsInterstitial:t.needsInterstitial,photoCount:t.photos,videoCount:t.videos,publicPhotosCount:t.countPhotosPublic,totalCount:parseInt(t.photos,10)+parseInt(t.videos,10),viewCount:t.countViews,canShare:t.canShare+(t.canShareDeep||0),canDownload:t.canDownload};c.push(p.addOrUpdate(o))}}),h={id:d,pathAlias:n.getValue("pathAlias"),totalItems:r.photosets.total},o=parseInt(r.photosets.perpage),a=parseInt(r.photosets.page),h.albumsList={perPage:o,page:a,pageContent:c,totalItems:r.photosets.total,totalPages:Math.ceil(r.photosets.total/o)},i.addOrUpdate(h),c}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["sets-models","set-models","person-models"]});YUI.add("sets-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ListFetchers["flickr-photosets-getList"].run(e,this.appContext)}},attributes:{id:{},pathAlias:{},albumsList:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-photosets-getList"]}},totalItems:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-getList-fetcher"]});YUI.add("flickr-photosets-removePhoto-deletor",function(e,t){"use strict";e.namespace("ModelCreators")["flickr-photosets-removePhoto"]={run:function(o,s){var l={full_response:1},i=[],u=o.isMultiplePhotos?"photo_ids":"photo_id",r=o.photoID.split(",").length;return l[u]=o.photoID,l.photoset_id=o.setID,o.includeHiddenSets&&(l.extras="hidden_sets",l.user_id=o.userId),i=[s.callAPI("flickr.photosets.removePhoto",l),s.getModel("set-models",o.setID),s.getModel("sets-models",s.getViewer().nsid,{page:1,perPage:s.flipper.isFlipped("enable-sets-list-loading-fix")||o.includeHiddenSets?10:500}),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-contexts-models")],o.isMultiplePhotos||i.push(s.getModel("photo-models",o.photoID)),e.Promise.all(i).then(function(e){var t,s=e[0],l=e[1],i=e[2],u=e[3],d=e[4];if("ok"===s.stat)return d.exists(o.photoID)&&d.getValue(o.photoID,"contexts").getFromListByID(o.setID)&&(d.setValue(o.photoID,"totalSets",d.getValue(o.photoID,"totalSets")-r),d.getValue(o.photoID,"contexts").removeFromList(o.setID)),u.exists(o.photoID)&&u.getValue(o.photoID,"sets").getFromListByID(o.setID)&&(u.setValue(o.photoID,"total",u.getValue(o.photoID,"total")-r),u.getValue(o.photoID,"sets").removeFromList(o.setID)),l&&(o.isMultiplePhotos?l&&o.updateItemCounts&&(l.setValue("photoCount",l.getValue("photoCount")-o.numberOfPhotosSelected),l.setValue("videoCount",l.getValue("videoCount")-o.numberOfVideosSelected)):(t=e[5],l.hasPhoto(t.getValue("id"))&&l.removePhoto(t),t.getValue("isVideo")?l.setValue("videoCount",l.getValue("videoCount")-r):l.setValue("photoCount",l.getValue("photoCount")-r)),l.getValue("totalCount")<1&&!o.includeHiddenSets)?(i.getValue("albumsList").remove(o.setID),l.registry.remove(o.setID),null):l},e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","sets-models","photo-sets-models","photo-contexts-models"]});YUI.add("flickr-photosets-delete-deletor",function(e,r){"use strict";e.namespace("ModelDeletors")["flickr-photosets-delete-deletor"]={run:function(o,t){return o.photoset_id=o.setID,o.gpCode&&(o.gp_code=o.gpCode),o.gpOwner&&(o.gp_owner=o.gpOwner),o.shareCode&&(o.share_code=o.shareCode),t.callAPI("flickr.photosets.delete",o).then(function(e){if(1===e.code)throw new Error(e)}).catch(e.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photosets-getPhotos-fetcher",function(e,o){"use strict";var t=require("hermes-core/flog")(o);e.namespace("ListFetchers")["flickr-photosets-getPhotos"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photosets.getPhotos",this._processParams(t),!0),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("set-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models"),s.getModelRegistry("album-privacy-models")]).then(function(e){return r._processResponse(e,t)},e.FetcherErrorLogger(o))},_processParams:function(o){o.page=o.page||1,o.perPage=o.perPage||100;var s={extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:o.perPage,page:o.page,get_user_info:1,primary_photo_extras:"url_c, url_h, url_k, url_l, url_m, url_n, url_o, url_q, url_s, url_sq, url_t, url_z, needs_interstitial, can_share",jump_to:o.withPhotoId||""};return o.gpCode&&null!==o.gpCode?(s.gp_code=o.gpCode,s.share_code=o.gpCode,s.gp_owner=o.gpOwner,t.info("Calling sets api with GP "+o.gpCode)):s.photoset_id=o.id.split("-")[0],o.includeHiddenSets&&(s.extras+=",hidden_sets",s.user_id=o.userId),o.viewAs&&(s.view_as=o.viewAs),o.filter&&(s.privacy_filter=o.filter),o.moderationFilter&&(s.moderation_filter=o.moderationFilter),s},_processResponse:function(o,t){var s,r,p,i,a,n=o[0],h=o[1],l=o[2],d=o[3],u=o[4],g=o[5],c=o[6],P=[],m=!1,_=!1,y=t.id;s=e.APIHelper.response.parsePerson(n.user),r=l.addOrUpdate(s),p={id:t.id,title:n.photoset.title,description:n.photoset.description,owner:r,primary:n.photoset.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(n.photoset),isAutoUploadSet:n.photoset.isAutoUploadSet,isSharedEntity:n.photoset.hidden&&1===n.photoset.hidden,photoCount:n.photoset.photoCount,videoCount:n.photoset.videoCount,publicPhotosCount:n.photoset.countPhotosPublic,primaryNeedsInterstitial:n.photoset.needsInterstitial,totalCount:parseInt(n.photoset.photoCount,10)+parseInt(n.photoset.videoCount,10),photoList:[],viewCount:n.photoset.countViews,canShare:n.photoset.canShare+(n.photoset.canShareDeep||0),canDownload:n.photoset.canDownload},y&&y!==n.photoset.id&&(p.id=y),"1"===n.photoset.isAutoUploadSet&&(p.canShare=!1),d.exists(t.id)&&(m=!!(i=d.getValue(t.id,"photoPageList")).hasMinBoundary&&i.hasMinBoundary(),_=!!i.hasMaxBoundary&&i.hasMaxBoundary(),P=i.getList()),a=e.APIHelper.response.parsePhotos({photos:n.photoset.photo,ownerID:n.photoset.owner,personModelRegistry:l,photoModelRegistry:h,photoEngagementModelRegistry:u,photoStatsModelRegistry:g}),p.photoPageList=e.APIHelper.response.addOrReplaceListByPage({current:P,perPage:t.perPage,pageNum:t.page,hasMax:_,hasMin:m,totalItems:n.photoset.total,newPages:a}),p.photoPageList={perPage:n.photoset.perPage,page:n.photoset.page,pageContent:a,totalItems:n.photoset.total},p.photoList.length&&(p.primary=n.photoset.primary);var f={id:p.id,countPhotosFamily:n.photoset.countPhotosFamily,countPhotosFriend:n.photoset.countPhotosFriend,countPhotosPublic:n.photoset.countPhotosPublic,countPhotosFriendFamily:n.photoset.countPhotosFriendFamily,totalCount:n.photoset.countPhotosAll};return c.exists(f.id)?c.setValues(t.id,f):c.add(f),d.exists(p.id)?d.setValue(t.id,"photoPageList",p.photoPageList):d.add(p),a}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","set-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-photosets-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-photosets-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photosets.getContext",this._processParams(t,s),!0),s.getModelRegistry("set-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw 2===e.code&&"Photo not in set"===e.message&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(o))},_processParams:function(o,t){var s={extras:e.APIHelper.request.getRebootPhotoExtras(),photo_id:o.photoId,num_prev:o.numNext,num_next:o.numPrev,get_photoset_info:1};return o.gpCode?(s.share_code=o.gpCode,s.share_owner=o.gpOwner,s.gp_code=o.gpCode,s.gp_owner=o.gpOwner):s.photoset_id=o.id,s},_processResponse:function(o,t){var s,r,n,p,h,i,a=o[0],d=o[1],g=o[2],l=o[3],u=o[4],m=o[5],c=[],x=[],y=g.proxy(t.photoId),M=[];return s=a.prevphotos,r=a.nextphotos,x=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:l,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),c=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:l,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),h=d.getValue(t.id,"photoContextList"),n=!!h.hasMinBoundary&&h.hasMinBoundary(),p=!!h.hasMaxBoundary&&h.hasMaxBoundary(),i=h.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:y,next:x,prev:c.reverse(),current:i,hasMin:n,hasMax:p,numNext:t.numNext,numPrev:t.numPrev}),d.setValue(t.id,"photoContextList",M),{next:x,previous:c.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});